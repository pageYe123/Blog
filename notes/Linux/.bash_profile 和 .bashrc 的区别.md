## .bash_profile 和 .bashrc 的区别

<details>
<summary>图解 bash 的加载顺序</summary>
<img alt="bash 的加载顺序" src="https://wx4.sinaimg.cn/large/6cdfff77gy1h48umb1dzpj217a0qjdm7.jpg">
<p>标注：在 Mac 中 ~/.bashrc 的父节点为 /etc/bashrc，在 Linux 中才是 /etc/bash.bashrc</p>
<p>该图准确性待考证。</p>
<p>~/.bash_profile 有4条线：远程和非远程各两种(login & non-interactive)、（login & interactive）</p>
<p>~/.bashrc 有2条线：非远程各两种(non-login & non-interactive)、（non-login & interactive）</p>
</details>

**`~/.bash_profile`在 login shell 中执行，而`~/.bashrc`在 non-login shell 中执行。**

Linux 环境，输入用户名和密码，进入到终端（terminal），就是一个 login shell 环境。比如通过`ssh`远程进入到主机，此时执行`.bash_profile`；在图形界面双击打开终端，没有输入用户名和密码，这时进入的就是 non-login shell环境，此时执行`.bashrc`。另外，当你在终端中输入`/bin/bash`来启动一个新的bash实例时，`.bashrc`也会执行。

不同的终端可能有不同的行为，比如 vscode 的内置终端可能又不一样（没有试验）。

macOS 的 terminal 就是个特例，它做了一些非标准的事情：每当新建一个窗口，总是进入 login shell 环境，这意味着`~/.bash_profile`会被执行。即使对 terminal 进行配置将 shell 由默认的 zsh 改为 bash 也是如此（将配置中`shell的打开方式`，由`默认登录shell`改为`命令（完整的路径）`，并输入`/bin/bash`）。

iterm2的表现就很正常，当设置 shell 为 `/bin/bash` 时，默认进入 non-login shell 环境，这意味着`~/.bashrc`会被执行，`~/.bash_profile`不会被执行。如果想进入 login shell 环境，设置命令为`/bin/bash --login`

<details>
<summary>图示：iterm2 配置</summary>
<img alt="iterm2 配置" src="https://wx4.sinaimg.cn/large/6cdfff77gy1h48vbjq2bhj20pi0h8gpl.jpg"/>
</details>

### 同时执行这两个文件

可以在`.bash_profile`中添加如下代码，这也是 [GNU bash manual](https://www.gnu.org/softwa//bash/manual/bash.html#Invoked-as-an-interactive-non_002dlogin-shell) 中推荐的。

```shell
if [ -f $HOME/.bashrc ]; then
        source $HOME/.bashrc
fi
```

shell 脚本中`-f`用以验证：提供的路径存在，且为一个文件（file）。

### 其他  

有一种判断 login shell VS non-login shell 的非常快速的方法，使用命令 `echo $0`

- `-bash` 中 `-` 表示当前是一个 login shell
- `/bin/bash` 表示是 non-login shell


### 参考资料：

- Stack Exchange: [What is the difference between .bash_profile and .bashrc?](https://apple.stackexchange.com/questions/51036/what-is-the-difference-between-bash-profile-and-bashrc)
